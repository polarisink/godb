# 介绍
作为一个开发者，在工作中我每台使用关系型数据库，但对我而言他们就是个黑盒。我有一些疑问：
- 数据是以什么格式存储的？（不管是在内存还是硬盘中）
- 什么时候数据从内存持久化进硬盘？
- 为什么每个表只能又一个主键？
- 事务回滚是如何实现的？
- 索引是什么格式？
- 什么时候会发生全表扫描
- 一个预处理语句是如何被存储的
换句话说，数据库是怎么工作的？
为了弄清楚这些，我正在编写一个玩具数据库。为了更好的理解它，我模仿了Sqlite，相比于MySQL和PostgreSQL，Sqlite不仅更简单，而且包含更少的特性。整个数据库都存储在一个文件中。

## Sqlite
这里是很多sqlite内部网站的[文档](https://www.sqlite.org/arch.html) ,此外我还将《SQLite Database System: Design and Implementation》做了一个[拷贝](https://play.google.com/store/books/details?id=9Z6IQQnX1JEC)

查询通过一系列组件来检索或修改数据。前端部分包括：
- 分词器
- 解释器
- 代码生成器
前端输入的是一个SQL查询。输出是 sqlite 虚拟机字节码(本质上是一个可以操作数据库的编译程序)

后端包括：
- 虚拟机
- B树
- 分页器
- 系统接口

虚拟机需要前端生成的指令。然后，它可以对一个或多个表或索引执行操作，每个表或索引都存储在称为B树的数据结构中。VM本质上是一个大的是switch字节码指令类型语句。

每个B树包含很多节点，每个节点的长度为一页。B 树可以从磁盘检索页面，或者通过向寻呼机发出命令将页面保存回磁盘。
